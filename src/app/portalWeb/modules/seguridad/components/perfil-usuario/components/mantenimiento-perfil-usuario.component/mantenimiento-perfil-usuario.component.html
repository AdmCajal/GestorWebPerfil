<p-dialog header="{{accion | titlecase}} {{ breadcrumb | titlecase}}" [modal]="true" [closable]="!barraBusqueda"
    [(visible)]="visualizarForm" [position]="position" [styleClass]="'md:w-12 w-11'" [maximizable]="true">

    <p-progressbar mode="indeterminate" class="mb-0 mt-0" [style]="{ height: '1px' }" *ngIf="barraBusqueda" />

    <div class="flex flex-wrap md:flex-nowrap gap-2">
        <p-fieldset legend="Datos Generales" class="col-3">
            <form class="flex flex-wrap" [formGroup]="mantenimientoForm">
                <div class="flex flex-col gap-2 pl-2 pr-2 md:col-12 col-12 ">
                    <label for="name1">Compañia <span class="font-semibold text-red-500">*</span></label>
                    <p-dropdown appendTo="body" [options]="lstCompanias" optionLabel="descripcion" optionValue="codigo"
                        formControlName="PERFIL" placeholder="Seleccione una opción"
                        (onChange)="btnObtenerSucursal($event)"></p-dropdown>
                </div>
                <div class="flex flex-col gap-2 pl-2 pr-2 md:col-12 col-12 ">
                    <label for="name1">Sucursal <span class="font-semibold text-red-500">*</span></label>
                    <p-dropdown appendTo="body" [options]="lstSucursal" optionLabel="descripcion" optionValue="codigo"
                        formControlName="PERFIL" placeholder="Seleccione una opción"></p-dropdown>
                </div>
                <div class="flex flex-col gap-2 pl-2 pr-2 md:col-12 col-12 ">
                    <label for="name1">Gerencia <span class="font-semibold text-red-500">*</span></label>
                    <p-dropdown appendTo="body" [options]="lstEstados" optionLabel="descripcion" optionValue="codigo"
                        formControlName="PERFIL" placeholder="Seleccione una opción"></p-dropdown>
                </div>
                <div class="flex flex-col gap-2 pl-2 pr-2 md:col-12 col-12 ">
                    <label for="name1">Responsable <span class="font-semibold text-red-500">*</span></label>
                    <input pInputText id="name1" placeholder="Ingrese nombre" type="text"
                        formControlName="NOMBRECOMPLETO" />
                </div>
                <div class="flex flex-col gap-2 pl-2 pr-2 md:col-12 col-12 ">
                    <label for="name1">Centro De Costo <span class="font-semibold text-red-500">*</span></label>
                    <p-dropdown appendTo="body" [options]="lstEstados" optionLabel="descripcion" optionValue="codigo"
                        formControlName="PERFIL" placeholder="Seleccione una opción"></p-dropdown>
                </div>
                <div class="flex flex-col gap-2 pl-2 pr-2 md:col-12 col-12 ">
                    <label for="name1">Perfil <span class="font-semibold text-red-500">*</span></label>
                    <input pInputText id="name1" type="text" placeholder="Ingrese el nombre del perfil" />
                </div>
            </form>
        </p-fieldset>
        <p-fieldset legend="Asignación De Aplicativos" class="col-9">

            <section class="flex flex-wrap">
                <div class="col-5">
                    <div class="flex col-12 ">
                        <p-dropdown appendTo="body" [options]="lstAplicativo" optionLabel="descripcion"
                            optionValue="codigo" [(ngModel)]="codigoAplicativoAgregar" [styleClass]="'w-12'"
                            placeholder="Seleccione una opción"></p-dropdown>
                        <p-button icon="pi pi-plus" class="ml-2" raised severity="success"
                            title="Agregar aplicativo seleccionado" (onClick)="onAgregarAplicativoSeleccionado()" />
                    </div>
                    <div class="border-round border-solid  border-1 border-300 col-12">
                        <h4 class="w-12 ml-2 mb-0 text-lg font-bold"> Aplicativos seleccionados:</h4>
                        <span class="header-label ml-4 mt-2" *ngIf="lstaplicativosSeleccionados.length ==0">Agregue
                            aplicativos...</span>
                        <div class="w-12 ml-3">
                            <div class="flex" *ngFor="let item of lstaplicativosSeleccionados">
                                <b>
                                    <p-button pButton pRipple type="button" severity="danger" icon="pi pi-minus" text
                                        [disabled]="!this.barraBusqueda" title="Eliminar Aplicativo" rounded></p-button>
                                    <span class="span-seleccion" pTooltip="Clic para ver módulos"
                                        tooltipPosition="right"
                                        (click)="onVerAplicativoSeleccionado(item)">{{item.Nombre}}</span>
                                </b>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-7 div-accesos-perfil">
                    <div class="flex">
                        <p-tree [value]="aplicativoSeleccionado.modulos" styleClass="w-full md:w-[30rem]" class="w-full"
                            selectionMode="checkbox">
                            <ng-template let-node #header>
                                <div class="w-12 flex justify-content-left ">
                                    <p class="w-12 flex flex-nowrap justify-content-between">
                                        <span class="header-label flex flex-wrap">
                                            Accesos del aplicativo:
                                            <span class="text-green-500 font-bold">
                                                {{aplicativoSeleccionado.Nombre}}
                                            </span>
                                        </span>
                                    </p>
                                </div>
                                <hr class="mt-0">
                            </ng-template>
                            <ng-template let-node pTemplate="empty">
                                <div class=" w-12 flex justify-content-center align-items-top   ">
                                    <p class="flex flex-nowrap justify-content-between  w-10  ">
                                        <span class="header-label ">{{comentarioModulos}}</span>
                                    </p>
                                </div>
                            </ng-template></p-tree>
                    </div>
                </div>
            </section>
        </p-fieldset>
    </div>

    <div class="flex flex-wrap justify-content-between">
        <!-- <app-log-modificaciones [componente]="this"></app-log-modificaciones> -->
        <p-fieldset [styleClass]="'font-bold'" legend="Log de modificaciones" *ngIf="visualizarLogMoficaciones">
            <div class="flex flex-column">
                <div class="flex">
                    <p-avatar label="P" styleClass="mr-2" size="large" shape="circle" />
                    <div class="w-11 ml-1">
                        <div class="text-400">Nota de <strong class="text-blue-700">Administrator</strong> - hace 4
                            días
                        </div>
                        <div class="font-medium"><strong class="font-bold">Se agregó un nuevo misceláneo:</strong>
                            Sucursal - SEG - Clínica el golf <strong class="font-bold">Fecha y hora:</strong>
                            2025-04-07
                            12:34:04</div>
                    </div>
                </div>
                <p-divider align="center" type="dotted">
                    <b>28 de enero de 2025</b>
                </p-divider>
            </div>
        </p-fieldset>
    </div>
    <ng-template #footer>

        <div class="gap-2">
            <p-button icon="pi pi-users" severity="secondary" class="mr-2" label="{{'Auditoria' | titlecase}}" raised
                *ngIf="accion != 'AGREGAR'" (onClick)="btnLogAuditoria()" />
            <p-button
                icon="pi {{!bloquearComponente ?  accion == 'AGREGAR' ? 'pi-plus':'pi-pencil': 'pi-spin pi-spinner' }}"
                class="ml-2" label="{{accion | titlecase}}" raised *ngIf="accion != 'VER'"
                (onClick)="btnConfirmarGuardarMantenimiento($event)" />
        </div>
    </ng-template>
</p-dialog>
<p-confirmdialog key="confirmarRegistroMantenimiento" />
<p-toast [showTransformOptions]="'translateY(90%)'" key="notification" position="bottom-right"></p-toast>